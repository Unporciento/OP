<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üöú HeavyDiag - Simulador Predictivo de Aver√≠as Mineras</title>
<style>
  /* --- ESTILOS CSS CONSOLIDADOS --- */
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Segoe UI', Arial, sans-serif; background: linear-gradient(135deg, #101820 0%, #1b2730 100%); min-height: 100vh; padding: 20px; color: #fff; }
  .container { max-width: 1200px; margin: 0 auto; }
  header { text-align: center; color: #f5af19; margin-bottom: 24px; }
  header h1 { font-size: 2.5rem; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.4); }
  .main-content { background: #222e39; border-radius: 12px; padding: 25px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); }
  .machines-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin: 15px 0; }
  .machine-card { background: linear-gradient(135deg, #f5af19 0%, #f7d794 100%); color: #000; padding: 15px; border-radius: 8px; cursor: pointer; border: 3px solid transparent; transition: all 0.2s; text-align: center; }
  .machine-card:hover { transform: translateY(-5px); box-shadow: 0 5px 15px rgba(245, 175, 25, 0.3); }
  .machine-card.selected { border-color: #e74c3c; background: #fff; box-shadow: 0 0 15px rgba(255, 0, 0, 0.5); }
  .machine-card strong { display: block; margin-top: 5px; }
  .failure-section { margin-top: 25px; }
  .failures-list { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 10px; }
  .failure-btn { background: #4a5d73; color: white; padding: 15px; border-radius: 8px; border: none; text-align: left; cursor: pointer; transition: background 0.2s; }
  .failure-btn:hover { background: #5d728c; }
  .failure-btn strong { display: block; margin-bottom: 5px; }
  .diagnosis-area { margin-top: 25px; background: #334455; padding: 20px; border-radius: 8px; }
  .info-card { background: #3e5163; padding: 15px; border-radius: 6px; margin-bottom: 15px; }
  .chain-step { background: #4a5d73; padding: 8px; border-radius: 4px; margin: 5px 0; border-left: 4px solid #f5af19; }
  ol, ul { margin-left: 20px; }
  .alert-safety { background: #e74c3c; border-left: 4px solid #c0392b; padding: 15px; border-radius: 6px; margin-bottom: 15px; }
  .alert-engineer { background: #27ae60; border-left: 4px solid #2ecc71; padding: 15px; border-radius: 6px; margin-bottom: 15px; }
  .action-buttons { display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap; }
  /* Estilo modificado para que el 'a' (enlace) se vea como bot√≥n */
  .search-btn { 
    background: #3498db; 
    color: #fff; 
    padding: 10px 15px; 
    border-radius: 5px; 
    border: none; 
    cursor: pointer; 
    transition: background 0.2s; 
    text-decoration: none; /* Quitar subrayado del enlace */
    display: inline-block; /* Alinear con el bot√≥n */
    font-size: 14px; /* Asegurar que el texto sea del mismo tama√±o */
    line-height: 1.5; /* Alinear verticalmente el texto */
  }
  .search-btn:hover { background: #2980b9; }
  .reset-btn { background: #95a5a6; }
</style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üöú HeavyDiag - Simulador Predictivo de Aver√≠as Mineras</h1>
      <p>Selecciona la m√°quina y la falla para obtener diagn√≥stico t√©cnico y gesti√≥n de costos.</p>
    </header>

    <div class="main-content">
      <section>
        <h2>Selecciona el tipo de maquinaria</h2>
        <div id="machinesGrid" class="machines-grid"></div>
      </section>

      <section id="failureSection" class="failure-section" style="display:none;">
        <h2>Selecciona una aver√≠a</h2>
        <div id="failuresList" class="failures-list"></div>
      </section>

      <section id="diagnosisArea" class="diagnosis-area" style="display:none;">
        <h2>Diagn√≥stico Completo y Gesti√≥n de Falla</h2>
        <div id="diagnosisResult"></div>

        <div class="action-buttons">
          <!-- Bot√≥n de Gemini ELIMINADO. Dejamos solo Google y Reset -->
          <a id="btnOpenGoogle" class="search-btn" href="#" target="_blank">üåê Abrir b√∫squedas en Google</a>
          <button id="btnReset" class="search-btn reset-btn">‚ôªÔ∏è Reiniciar Todo</button>
        </div>
        
        <!-- Contenedor de Gemini ELIMINADO -->

      </section>
    </div>
  </div>

<script>
/* ----------------------------------------------------------------------------------------- */
/* HEAVYDIAG - DATOS Y L√ìGICA (Versi√≥n Est√°tica SIN API) */
/* ----------------------------------------------------------------------------------------- */

const machines = {
    retroexcavadora: { name: "Retroexcavadora", icon: "üöú", description: "Excavaci√≥n y carga" },
    excavadora: { name: "Excavadora Hidr√°ulica", icon: "‚õèÔ∏è", description: "Excavaci√≥n profunda" },
    cargador: { name: "Cargador Frontal", icon: "üèóÔ∏è", description: "Carga de material" },
    dumper: { name: "Cami√≥n Minero (Dumper)", icon: "üöõ", description: "Transporte de material" },
    skidsteer: { name: "Cargador Compacto", icon: "üöß", description: "Equipo auxiliar y soporte" },
    camioneta: { name: "Camioneta Minera 4x4", icon: "üöô", description: "Transporte de personal" }
};

// Esta es tu base de datos de conocimiento. ¬°Puedes agregar m√°s fallas aqu√≠!
const failures = {
    retroexcavadora: [
        {
            id: 1, name: "Ingreso de agua al motor (Hydrolock)", initial: "Motor se apaga s√∫bitamente tras cruzar un charco.",
            alertaSeguridad: "‚ö†Ô∏è CR√çTICO: NO intentar arrancar de nuevo. Esto puede causar una fractura del bloque o c√°rter.",
            chainReaction: ["Agua entra a la c√°mara de combusti√≥n", "El agua es incompresible (Hydrolock)", "Bielas se doblan o rompen (fuerza extrema)", "Da√±o al cig√ºe√±al y fisura del bloque"],
            symptoms: ["Motor detenido s√∫bitamente", "No gira al intentar arrancar", "Aceite con aspecto lechoso"],
            diagnosticSteps: ["1. NO intentar encendido.", "2. Retirar inyectores/buj√≠as y girar motor manualmente para drenar agua.", "3. Revisar aspecto del aceite (emulsi√≥n lechosa)."],
            solution: ["Desmontaje completo del motor.", "Reemplazo de bielas y pistones.", "Cambio m√∫ltiple de aceite y filtros."],
            tiempoDowntime: "120 - 240 horas (por reconstrucci√≥n del motor).",
            costoEstimado: "US$ 15,000 - US$ 50,000.", searchTerms: "hydrolock motor diesel maquinaria pesada bielas dobladas",
            datoIngeniero: "La compresi√≥n del agua genera picos de presi√≥n que superan el l√≠mite el√°stico del acero de la biela en milisegundos."
        },
        {
            id: 2, name: "Drift o Hundimiento del Brazo (Arm Drift)", initial: "El brazo de excavaci√≥n desciende lentamente al dejarlo en posici√≥n extendida.",
            alertaSeguridad: "M√°quina operable, pero riesgo de ca√≠da de carga. Asegurar √°rea de trabajo.",
            chainReaction: ["Fuga interna en el cilindro de brazo (sellos de pist√≥n).", "V√°lvula de Bloqueo (Lock Valve) defectuosa en el banco de v√°lvulas.", "P√©rdida de eficiencia por necesidad de potencia constante."],
            symptoms: ["Brazo no mantiene posici√≥n", "Movimiento lento o err√°tico"],
            diagnosticSteps: ["1. Calentar aceite a temperatura de operaci√≥n.", "2. Medir tasa de ca√≠da (drift rate) con carga.", "3. Medir presi√≥n en el lado de bloqueo del cilindro para aislar cilindro vs. v√°lvula."],
            solution: ["Reemplazo de sellos internos de pist√≥n.", "Reemplazo del cartucho de la V√°lvula de Bloqueo."],
            tiempoDowntime: "10 - 30 horas (si el problema es un cilindro).",
            costoEstimado: "US$ 1,500 - US$ 8,000.", searchTerms: "hydraulic arm drift excavator lock valve cylinder seal failure"
        }
    ],
    dumper: [
        {
            id: 3, name: "Fallo Sensor de Velocidad de Transmisi√≥n (DTC 281-04)", initial: "Transmisi√≥n no hace cambios, o se bloquea en una marcha fija.",
            alertaSeguridad: "Maquina inoperativa (modo Limp Home). Riesgo bajo, pero inmovilizar el equipo.",
            chainReaction: ["ECU no recibe se√±al de velocidad (G69).", "Sistema entra en modo de protecci√≥n (Limp Home).", "Se puede recalentar la transmisi√≥n a largo plazo."],
            symptoms: ["Transmisi√≥n bloqueada", "Luz de 'Check Trans' encendida", "Veloc√≠metro err√°tico o nulo"],
            diagnosticSteps: ["1. Escanear c√≥digo 281-04 o similar.", "2. Revisar visualmente el sensor G69.", "3. Comprobar continuidad y aislamiento del arn√©s (cableado)."],
            solution: ["Reparaci√≥n o reemplazo del arn√©s del sensor G69.", "Reemplazo del sensor de velocidad."],
            tiempoDowntime: "4 - 12 horas.",
            costoEstimado: "US$ 500 - US$ 1,500.", searchTerms: "DTC 281-04 sensor velocidad transmisi√≥n allison G69"
        },
        {
            id: 4, name: "Sobrecalentamiento Transmisi√≥n (Frenado Excesivo)", initial: "Luz de advertencia de alta temperatura de transmisi√≥n; olor a quemado.",
            alertaSeguridad: "APAGAR INMEDIATAMENTE. Alto riesgo de incendio o falla catastr√≥fica.",
            chainReaction: ["Degradaci√≥n r√°pida del aceite (ATF).", "Da√±o por calor en sellos y discos de embrague.", "Fallo del Convertidor de Par."],
            symptoms: ["Temperatura alta", "Cambios bruscos", "Olor a aceite quemado"],
            diagnosticSteps: ["1. Revisar nivel y olor/color del aceite.", "2. Inspeccionar el enfriador de aceite (obstrucci√≥n).", "3. Escanear c√≥digos de falla de alta temperatura (ej. DTC 190-XX)."],
            solution: ["Limpieza/reparaci√≥n del enfriador.", "Cambio de aceite y filtros.", "Si hay da√±o: reconstrucci√≥n total de la caja."],
            tiempoDowntime: "24 - 48 horas (limpieza/reparaci√≥n menor); 160+ horas (reconstrucci√≥n).",
            costoEstimado: "US$ 2,500 - US$ 80,000.", searchTerms: "sobrecalentamiento transmision dumper camion minero retardador"
        }
    ],
    camioneta: [
        {
            id: 5, name: "Vibraci√≥n Severa del Eje de Transmisi√≥n", initial: "Vibraci√≥n muy fuerte al acelerar o a cierta velocidad.",
            alertaSeguridad: "M√°quina inoperativa. Detener el veh√≠culo inmediatamente. El eje puede desbalancearse.",
            chainReaction: ["Fractura o fisura en eje (propeller shaft).", "Desgaste o da√±o en crucetas (U-Joints).", "Da√±o al pi√±√≥n y corona del diferencial por estr√©s."],
            symptoms: ["Ruido met√°lico (clunk) al cambiar", "Vibraci√≥n que aumenta con la velocidad"],
            diagnosticSteps: ["1. Inspeccionar visualmente el eje por golpes.", "2. Verificar holgura en las crucetas/juntas universales.", "3. Revisar soportes de motor y transmisi√≥n."],
            solution: ["Reemplazo del eje de transmisi√≥n.", "Cambio de crucetas/juntas universales y re-balanceo."],
            tiempoDowntime: "4 - 8 horas.",
            costoEstimado: "US$ 1,500 - US$ 4,000.", searchTerms: "fractura eje de transmisi√≥n camioneta minera vibraci√≥n 4x4"
        }
    ],
    excavadora: [
        {
            id: 6, name: "Falla en Circuito Piloto (Movimientos Lentos)", initial: "Todos los movimientos hidr√°ulicos son lentos y d√©biles.",
            alertaSeguridad: "Operable, pero con riesgo de control impreciso. Proceder a diagn√≥stico con la cabina bloqueada.",
            chainReaction: ["Presi√≥n Piloto insuficiente (debajo de 4100 kPa/595 psi).", "Carretes de la v√°lvula principal no se desplazan completamente.", "P√©rdida de fuerza de la bomba por regulaci√≥n incorrecta."],
            symptoms: ["Velocidad de ciclo muy lenta", "Palancas de control suaves", "Dificultad en combinar movimientos"],
            diagnosticSteps: ["1. Conectar man√≥metro a toma de presi√≥n piloto.", "2. Verificar que la presi√≥n est√© en el rango **4100 kPa (595 psi) ¬± 200 kPa**.", "3. Revisar la V√°lvula Reductora de Presi√≥n Piloto."],
            solution: ["Ajuste de la v√°lvula de alivio piloto.", "Limpieza/reemplazo del filtro piloto."],
            tiempoDowntime: "8 - 24 horas.",
            costoEstimado: "US$ 1,500 - US$ 6,000.", searchTerms: "presi√≥n nominal sistema piloto excavadora 4100 kPa",
            datoIngeniero: "La presi√≥n piloto es de 'baja presi√≥n' y act√∫a como la se√±al nerviosa del sistema; si es baja, el sistema principal no act√∫a, aunque la bomba principal est√© sana."
        }
    ],
    // Puedes agregar m√°s fallas a 'cargador' y 'skidsteer' aqu√≠
    cargador: [], 
    skidsteer: [] 
};

// --- UI / L√ìGICA ---
let selectedMachineKey = null;
let selectedFailure = null;
const grid = document.getElementById('machinesGrid');
const failureSection = document.getElementById('failureSection');
const diagnosisArea = document.getElementById('diagnosisArea');
const diagnosisResult = document.getElementById('diagnosisResult');

function initMachines(){
    grid.innerHTML = '';
    Object.keys(machines).forEach(key=>{
        const m = machines[key];
        const card = document.createElement('div');
        card.className = 'machine-card';
        card.innerHTML = `<div style="font-size:28px">${m.icon}</div><strong>${m.name}</strong><div style="font-size:12px;margin-top:6px">${m.description}</div>`;
        card.onclick = () => {
            document.querySelectorAll('.machine-card').forEach(c=>c.classList.remove('selected'));
            card.classList.add('selected');
            selectMachine(key);
        };
        grid.appendChild(card);
    });
}

function selectMachine(key) {
    selectedMachineKey = key;
    const list = document.getElementById('failuresList');
    list.innerHTML = '';
    failureSection.style.display = 'block';
    diagnosisArea.style.display = 'none';

    const machineFailures = failures[key] || [];

    if (machineFailures.length === 0) {
        list.innerHTML = `<p style="color: #f5af19; padding: 10px;">A√∫n no hay fallas definidas para ${machines[key].name}.</p>`;
    } else {
        machineFailures.forEach(f => {
            const btn = document.createElement('button');
            btn.className = 'failure-btn';
            btn.innerHTML = `<strong>${f.name}</strong><div style="font-size:12px;margin-top:6px;color:#ccc">${f.initial}</div>`;
            btn.onclick = () => showDiagnosis(f);
            list.appendChild(btn);
        });
    }
}

function showDiagnosis(f) {
    selectedFailure = f;
    diagnosisArea.style.display = 'block';
    
    // --- CONSTRUCCI√ìN DEL HTML DE DIAGN√ìSTICO ENRIQUECIDO ---
    diagnosisResult.innerHTML = `
        <div class="alert-safety">
            <h4>‚ö†Ô∏è ALERTA DE SEGURIDAD (HSE)</h4>
            <p>${f.alertaSeguridad}</p>
        </div>

        <div class="info-card">
            <h4>SINTOMAS Y CONTEXTO</h4>
            <p><strong>Contexto Inicial:</strong> ${f.initial}</p>
            <ul>${f.symptoms.map(s=>`<li>${s}</li>`).join('')}</ul>
        </div>
        
        <div class="info-card">
            <h4>CADENA DE FALLA (Efecto Domin√≥)</h4>
            ${f.chainReaction.map(c=>`<div class="chain-step">${c}</div>`).join('')}
        </div>

        <div class="info-card">
            <h4>PASOS DE DIAGN√ìSTICO Y REVISI√ìN</h4>
            <ol>${f.diagnosticSteps.map(s=>`<li>${s}</li>`).join('')}</ol>
        </div>

        <div class="info-card">
            <h4>GESTI√ìN Y LOG√çSTICA</h4>
            <p><strong>Costo Estimado de Reparaci√≥n:</strong> ${f.costoEstimado || 'No disponible'}</p>
            <p><strong>Tiempo de Inactividad (Downtime):</strong> ${f.tiempoDowntime || 'Variable'}</p>
        </div>
        
        ${f.datoIngeniero ? 
          `<div class="alert-engineer">
              <h4>üí° Dato T√©cnico del Ingeniero</h4>
              <p>${f.datoIngeniero}</p>
          </div>` : ''
        }
    `;
    
    // Asignar din√°micamente el enlace de b√∫squeda de Google
    const googleBtn = document.getElementById('btnOpenGoogle');
    const q = encodeURIComponent(f.searchTerms || f.name);
    // El 'href' se actualiza cada vez que se selecciona una falla
    googleBtn.href = `https://www.google.com/search?q=${q}`;

    // Desplazar al √°rea de diagn√≥stico
    window.scrollTo({top: diagnosisArea.offsetTop - 50, behavior:'smooth'});
}

// --- BOTONES DE ACCI√ìN ---
document.addEventListener('DOMContentLoaded', () => {
    // Inicia las m√°quinas cuando la p√°gina carga
    initMachines();
    
    // L√≥gica del bot√≥n de Reset
    document.getElementById('btnReset').addEventListener('click', () => {
        location.reload();
    });
});
</script>
</body>
</html>

