<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Evaluaci√≥n T√©cnica - Parametrizaci√≥n</title>
    <style>
        :root {
            --primary: #003366; /* Azul Institucional */
            --secondary: #f4f4f4; /* Gris fondo */
            --accent: #d32f2f; /* Rojo detalle */
            --text: #333;
            --white: #fff;
            --border: #ccc;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: var(--secondary);
            color: var(--text);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* HEADER */
        header {
            background-color: var(--primary);
            color: var(--white);
            width: 100%;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        h1 { margin: 0; font-size: 1.5rem; text-transform: uppercase; letter-spacing: 1px; }
        p.subtitle { margin: 5px 0 0; font-size: 0.9rem; opacity: 0.9; }

        /* CONTENEDOR PRINCIPAL */
        .container {
            background: var(--white);
            width: 95%;
            max-width: 800px;
            margin: 30px auto;
            padding: 30px;
            border-radius: 5px;
            border: 1px solid var(--border);
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        /* MENU DE SELECCI√ìN */
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .menu-card {
            border: 1px solid var(--border);
            border-radius: 5px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            background: #fafafa;
        }

        .menu-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-color: var(--primary);
        }

        .menu-icon { font-size: 2.5rem; margin-bottom: 10px; display: block; }
        .menu-title { font-weight: bold; font-size: 1.1rem; color: var(--primary); }
        .menu-desc { font-size: 0.85rem; color: #666; margin-top: 5px; }

        /* √ÅREA DE PREGUNTAS */
        .quiz-section { display: none; }

        .progress-bar {
            background: #e0e0e0;
            height: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: var(--primary);
            width: 0%;
            transition: width 0.3s;
        }

        .question-box {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 25px;
            border-left: 5px solid var(--accent);
            padding-left: 15px;
            line-height: 1.4;
        }

        .options-list { display: flex; flex-direction: column; gap: 10px; }

        button.option-btn {
            background: var(--white);
            border: 1px solid var(--border);
            padding: 15px;
            text-align: left;
            font-size: 1rem;
            cursor: pointer;
            border-radius: 4px;
            transition: background 0.2s;
            color: var(--text);
        }

        button.option-btn:hover { background: #f0f4f8; border-color: var(--primary); }
        
        button.correct { background: #e8f5e9 !important; border-color: #4caf50 !important; color: #2e7d32; font-weight: bold; }
        button.wrong { background: #ffebee !important; border-color: #ef5350 !important; color: #c62828; }

        .feedback {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-left: 4px solid #666;
            display: none;
            font-size: 0.95rem;
        }

        .action-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 1rem;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 20px;
            display: none;
            float: right;
        }
        .action-btn:hover { background: #002244; }

        .back-btn {
            background: #666;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        /* RESULTADOS */
        .results { text-align: center; display: none; }
        .score-big { font-size: 4rem; font-weight: bold; color: var(--primary); margin: 20px 0; }

    </style>
</head>
<body>

<header>
    <h1>Plataforma de Evaluaci√≥n T√©cnica</h1>
    <p class="subtitle">Parametrizaci√≥n Electr√≥nica | Maquinaria Pesada</p>
</header>

<div class="container" id="main-menu">
    <h3>Seleccione el M√≥dulo de Evaluaci√≥n:</h3>
    <div class="menu-grid">
        <div class="menu-card" onclick="startQuiz('math')">
            <span class="menu-icon">üßÆ</span>
            <div class="menu-title">Taller de C√°lculo</div>
            <div class="menu-desc">Ley de Ohm y Watt con voltaje impl√≠cito (12V/24V).</div>
        </div>

        <div class="menu-card" onclick="startQuiz('scope')">
            <span class="menu-icon">üìü</span>
            <div class="menu-title">Osciloscopio</div>
            <div class="menu-desc">Configuraci√≥n, lectura de ondas y diagn√≥stico.</div>
        </div>

        <div class="menu-card" onclick="startQuiz('exam')">
            <span class="menu-icon">üìù</span>
            <div class="menu-title">Simulacro Examen</div>
            <div class="menu-desc">20 preguntas aleatorias de TODO el temario.</div>
        </div>
    </div>
</div>

<div class="container quiz-section" id="quiz-interface">
    <button class="back-btn" onclick="location.reload()">‚Üê Volver al Men√∫</button>
    
    <div class="progress-bar">
        <div class="progress-fill" id="progress-fill"></div>
    </div>

    <div class="question-box" id="question-text">
        Cargando pregunta...
    </div>

    <div class="options-list" id="options-container">
        </div>

    <div class="feedback" id="feedback-box"></div>
    <button class="action-btn" id="next-btn" onclick="nextQuestion()">Siguiente Pregunta</button>
</div>

<div class="container results" id="results-screen">
    <h2>Evaluaci√≥n Finalizada</h2>
    <p>Su calificaci√≥n obtenida es:</p>
    <div class="score-big" id="final-score">0.0</div>
    <p id="final-msg">Mensaje de estado...</p>
    <button class="action-btn" style="display:inline-block; float:none;" onclick="location.reload()">Realizar Nueva Evaluaci√≥n</button>
</div>

<script>
    // --- BASE DE DATOS FIJA (TEOR√çA Y OSCILOSCOPIO) ---
    const theoryQuestions = [
        // OSCILOSCOPIO
        { q: "En el osciloscopio, ¬øqu√© ajuste controla la escala vertical?", opts: ["Volts/Div", "Sec/Div", "Trigger", "Position"], a: 0, tag: "scope", exp: "Volts/Div ajusta la amplitud (voltaje)." },
        { q: "Si visualizas una se√±al digital CAN BUS, ¬øqu√© unidad de tiempo es m√°s apropiada?", opts: ["Microsegundos (us)", "Segundos (s)", "Minutos", "Horas"], a: 0, tag: "scope", exp: "Las redes de datos son muy r√°pidas (500 kbps), requieren 'us'." },
        { q: "El 'Trigger' o Disparo sirve para:", opts: ["Estabilizar la se√±al en pantalla", "Aumentar el voltaje", "Filtrar ruido", "Guardar la imagen"], a: 0, tag: "scope", exp: "El Trigger sincroniza el inicio del barrido para que la onda se vea quieta." },
        { q: "¬øQu√© indica el acoplamiento AC en la medici√≥n?", opts: ["Solo componente alterna (bloquea DC)", "Solo componente continua", "Mide resistencia", "Apaga el canal"], a: 0, tag: "scope", exp: "AC Coupling elimina el voltaje base para ver solo las variaciones (ruido)." },
        { q: "Al medir un actuador PWM, el 'Duty Cycle' representa:", opts: ["El porcentaje de tiempo en ON", "El voltaje m√°ximo", "La frecuencia de la se√±al", "La resistencia de la bobina"], a: 0, tag: "scope", exp: "Duty Cycle es el ciclo de trabajo activo (%) en un periodo." },
        { q: "Si usas una sonda atenuadora x10 midiendo 12V, ¬øcu√°nto voltaje entra realmente al osciloscopio?", opts: ["1.2 V", "12 V", "120 V", "0.12 V"], a: 0, tag: "scope", exp: "La sonda divide por 10. Entran 1.2V, por eso debes configurar el equipo en x10." },
        { q: "El cable negro de la sonda del osciloscopio se conecta a:", opts: ["Masa (Chasis)", "Positivo Bater√≠a", "Se√±al", "Alternador"], a: 0, tag: "scope", exp: "Siempre a masa. Conectarlo a positivo causa corto." },
        
        // SENSORES
        { q: "¬øQu√© tipo de se√±al emite un sensor CKP Inductivo?", opts: ["Anal√≥gica (Senoidal)", "Digital (Cuadrada)", "PWM", "Constante"], a: 0, tag: "theory", exp: "El inductivo genera voltaje AC, creando una onda senoidal." },
        { q: "Un sensor de Efecto Hall necesita:", opts: ["Alimentaci√≥n, Masa y Se√±al (3 cables)", "Solo 2 cables", "No necesita alimentaci√≥n", "Presi√≥n de aire"], a: 0, tag: "theory", exp: "El Hall es un chip activo, requiere voltaje externo para funcionar." },
        { q: "En un termistor NTC, si la temperatura aumenta:", opts: ["La resistencia disminuye", "La resistencia aumenta", "El voltaje sube", "No cambia nada"], a: 0, tag: "theory", exp: "NTC = Coeficiente Negativo. M√°s calor, menos resistencia." },
        { q: "Para equilibrar un Puente de Wheatstone, el voltaje entre los puntos centrales debe ser:", opts: ["0 Voltios", "5 Voltios", "12 Voltios", "Infinito"], a: 0, tag: "theory", exp: "El equilibrio significa diferencia de potencial cero." },
        
        // MAQUETA Y CABLEADO
        { q: "En la maquinaria, el 'Master Switch' corta:", opts: ["El negativo (o positivo) principal de la bater√≠a", "Solo las luces", "Solo el arranque", "La radio"], a: 0, tag: "theory", exp: "El cortacorriente a√≠sla la bater√≠a del resto del chasis." },
        { q: "Si mides continuidad en un fusible y el mult√≠metro marca 'OL', el fusible est√°:", opts: ["Quemado (Abierto)", "Bueno", "En cortocircuito", "Operativo"], a: 0, tag: "theory", exp: "OL (Open Loop) significa que no hay camino para la corriente." },
        { q: "El terminal 30 de un rel√© est√°ndar se conecta habitualmente a:", opts: ["Potencia (Bater√≠a/Fusible)", "Salida a consumidor", "Masa", "Se√±al de control"], a: 0, tag: "theory", exp: "30 es la entrada de potencia (Com√∫n)." },
        { q: "El terminal 86 de un rel√© corresponde a:", opts: ["Bobina (Control +)", "Potencia", "Salida", "Masa"], a: 0, tag: "theory", exp: "85 y 86 son la bobina de control." }
    ];

    // --- GENERADOR DE MATEM√ÅTICAS (INFINITO) ---
    const vehicles12 = ["Toyota Hilux", "Mitsubishi L200", "Nissan V16", "Suzuki Swift", "Ford Ranger", "Moto Honda", "Kia Rio"];
    const vehicles24 = ["Cami√≥n Volvo FH", "Cargador Frontal CAT", "Excavadora Komatsu", "Bus Scania", "Cami√≥n Minero", "Tractor John Deere"];

    function generateMathQuestion() {
        const type = Math.floor(Math.random() * 3); // 0: Intensidad, 1: Resistencia, 2: Potencia
        const is24V = Math.random() > 0.5;
        const vehicle = is24V ? vehicles24[Math.floor(Math.random() * vehicles24.length)] : vehicles12[Math.floor(Math.random() * vehicles12.length)];
        const voltage = is24V ? 24 : 12;
        
        let qText, correct, dist1, dist2, dist3, explanation;

        if (type === 0) { // Calcular Intensidad (I = V/R)
            const R = Math.floor(Math.random() * 20) + 2; // 2 a 22 Ohms
            const I = (voltage / R).toFixed(2);
            qText = `Est√°s diagnosticando un <b>${vehicle}</b>. Mides una resistencia de <b>${R} Ohms</b> en un componente. ¬øCu√°l es la Intensidad te√≥rica que circula?`;
            correct = `${I} A`;
            dist1 = `${(voltage * R).toFixed(0)} A`; // Error multiplicar
            dist2 = `${(R / voltage).toFixed(2)} A`; // Error dividir al rev√©s
            dist3 = `${(12 / R).toFixed(2)} A`; // Error de voltaje incorrecto (trampa)
            explanation = `Ley de Ohm: I = V / R. <br>Como es ${vehicle}, usas <b>${voltage}V</b>. <br>${voltage}V / ${R}Œ© = <b>${I}A</b>.`;
        } 
        else if (type === 1) { // Calcular Resistencia (R = V/I)
            const I = Math.floor(Math.random() * 10) + 1; 
            const R = (voltage / I).toFixed(1);
            qText = `En un <b>${vehicle}</b>, mides un consumo de corriente de <b>${I} Amperios</b> en un circuito. ¬øCu√°l es la resistencia de la carga?`;
            correct = `${R} Œ©`;
            dist1 = `${(voltage * I).toFixed(0)} Œ©`;
            dist2 = "0.5 Œ©";
            dist3 = `${(12 / I).toFixed(1)} Œ©`; 
            explanation = `Ley de Ohm: R = V / I. <br>Veh√≠culo ${vehicle} usa <b>${voltage}V</b>. <br>${voltage}V / ${I}A = <b>${R}Œ©</b>.`;
        }
        else { // Calcular Potencia (P = V*I)
            const I = Math.floor(Math.random() * 15) + 2;
            const P = voltage * I;
            qText = `Necesitas reemplazar un fusible en un <b>${vehicle}</b>. El circuito consume <b>${I} Amperios</b>. ¬øQu√© potencia el√©ctrica est√° consumiendo?`;
            correct = `${P} Watts`;
            dist1 = `${(voltage / I).toFixed(1)} Watts`;
            dist2 = `${P * 2} Watts`;
            dist3 = `${(12 * I)} Watts`; // Trampa voltaje 12v en cami√≥n
            explanation = `Ley de Watt: P = V x I. <br>Veh√≠culo ${vehicle} usa <b>${voltage}V</b>. <br>${voltage}V x ${I}A = <b>${P}W</b>.`;
        }

        return {
            q: qText,
            opts: [correct, dist1, dist2, dist3].sort(() => 0.5 - Math.random()),
            a: -1, // Se calcular√° din√°micamente al buscar el √≠ndice de 'correct'
            correctVal: correct,
            tag: "math",
            exp: explanation
        };
    }

    // --- L√ìGICA DEL EXAMEN ---
    let currentQuiz = [];
    let currentIndex = 0;
    let score = 0;

    function startQuiz(mode) {
        currentQuiz = [];
        currentIndex = 0;
        score = 0;

        // 1. GENERAR BANCO DE PREGUNTAS SEG√öN MODO
        if (mode === 'math') {
            // Generar 20 preguntas matem√°ticas nuevas
            for(let i=0; i<20; i++) currentQuiz.push(generateMathQuestion());
        } 
        else if (mode === 'scope') {
            // Filtrar solo preguntas de osciloscopio
            currentQuiz = theoryQuestions.filter(q => q.tag === 'scope');
            // Duplicarlas o revolverlas si son pocas, o mezclar
            currentQuiz = currentQuiz.sort(() => 0.5 - Math.random());
        } 
        else if (mode === 'exam') {
            // MODO EXAMEN: MEZCLA TOTAL
            // Tomamos toda la teor√≠a
            let pool = [...theoryQuestions]; 
            // Generamos 30 matem√°ticas para engordar el pool
            for(let i=0; i<30; i++) pool.push(generateMathQuestion());
            
            // Barajar todo el pool gigante
            pool.sort(() => 0.5 - Math.random());
            
            // Tomar solo 20 preguntas
            currentQuiz = pool.slice(0, 20);
        }

        // Ajustar √≠ndices de respuestas correctas para las generadas
        currentQuiz.forEach(q => {
            if(q.a === -1) {
                q.a = q.opts.indexOf(q.correctVal);
            }
        });

        // UI
        document.getElementById('main-menu').style.display = 'none';
        document.getElementById('quiz-interface').style.display = 'block';
        document.getElementById('results-screen').style.display = 'none';
        
        loadQuestion();
    }

    function loadQuestion() {
        const q = currentQuiz[currentIndex];
        
        // Barra de progreso
        const pct = ((currentIndex) / currentQuiz.length) * 100;
        document.getElementById('progress-fill').style.width = `${pct}%`;

        document.getElementById('question-text').innerHTML = `${currentIndex + 1}. ${q.q}`;
        
        const optsContainer = document.getElementById('options-container');
        optsContainer.innerHTML = '';

        q.opts.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerHTML = opt;
            btn.onclick = () => checkAnswer(idx, btn, q);
            optsContainer.appendChild(btn);
        });

        document.getElementById('feedback-box').style.display = 'none';
        document.getElementById('next-btn').style.display = 'none';
    }

    function checkAnswer(selectedIdx, btn, qData) {
        // Bloquear botones
        const allBtns = document.querySelectorAll('.option-btn');
        allBtns.forEach(b => b.disabled = true);

        const feedback = document.getElementById('feedback-box');
        feedback.style.display = 'block';

        if(selectedIdx === qData.a) {
            score++;
            btn.classList.add('correct');
            feedback.innerHTML = `<span style="color:green; font-weight:bold;">‚úÖ Correcto</span><br>${qData.exp}`;
        } else {
            btn.classList.add('wrong');
            // Mostrar la correcta
            allBtns[qData.a].classList.add('correct');
            feedback.innerHTML = `<span style="color:red; font-weight:bold;">‚ùå Incorrecto</span><br>${qData.exp}`;
        }

        document.getElementById('next-btn').style.display = 'block';
    }

    function nextQuestion() {
        currentIndex++;
        if(currentIndex < currentQuiz.length) {
            loadQuestion();
        } else {
            showResults();
        }
    }

    function showResults() {
        document.getElementById('quiz-interface').style.display = 'none';
        document.getElementById('results-screen').style.display = 'block';

        // Nota escala 1.0 a 7.0 (Chile)
        // Puntaje max = currentQuiz.length
        // Formula: (Puntaje / Max) * 7. (Ajuste simple)
        let grade = (score / currentQuiz.length) * 7;
        if(grade < 1) grade = 1;
        
        document.getElementById('final-score').innerText = grade.toFixed(1);
        
        let msg = "";
        if(grade >= 6) msg = "¬°Excelente! Est√°s listo para el examen.";
        else if(grade >= 4) msg = "Aprobado. Tienes los conceptos, pero repasa los errores.";
        else msg = "Reprobado. Necesitas estudiar m√°s las f√≥rmulas y teor√≠a.";
        
        document.getElementById('final-msg').innerText = `${msg} (${score}/${currentQuiz.length} aciertos)`;
    }

</script>

</body>
</html>
