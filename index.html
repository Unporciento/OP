<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üöú HeavyDiag - Simulador Predictivo de Aver√≠as Mineras</title>
<style>
  /* --- ESTILOS CSS MEJORADOS --- */
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Segoe UI', Arial, sans-serif; background: linear-gradient(135deg, #101820 0%, #1b2730 100%); min-height: 100vh; padding: 20px; color: #e0e0e0; line-height: 1.6; }
  .container { max-width: 1200px; margin: 0 auto; }
  header { text-align: center; color: #f5af19; margin-bottom: 30px; }
  header h1 { font-size: 2.6rem; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.4); margin-bottom: 5px; }
  header p { font-size: 1.1rem; color: #cccccc; }
  .main-content { background: #222e39; border-radius: 12px; padding: 30px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6); }

  h2 { color: #f5af19; margin-bottom: 15px; border-bottom: 2px solid #4a5d73; padding-bottom: 5px; }

  /* Grid de M√°quinas */
  .machines-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 18px; margin-bottom: 25px; }
  .machine-card { background: linear-gradient(135deg, #f5af19 0%, #f7d794 100%); color: #111; padding: 18px; border-radius: 8px; cursor: pointer; border: 3px solid transparent; transition: all 0.25s ease-in-out; text-align: center; box-shadow: 0 4px 8px rgba(0,0,0,0.3); }
  .machine-card:hover { transform: translateY(-6px); box-shadow: 0 8px 20px rgba(245, 175, 25, 0.4); }
  .machine-card.selected { border-color: #e74c3c; background: #fff; box-shadow: 0 0 20px rgba(231, 76, 60, 0.6); }
  .machine-card strong { display: block; margin-top: 8px; font-size: 1.1rem; }
  .machine-card .description { font-size: 0.85rem; color: #333; margin-top: 4px; }

  /* Lista de Fallas */
  .failure-section { margin-top: 30px; }
  .failures-list { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 12px; }
  .failure-btn { background: #4a5d73; color: #f0f0f0; padding: 15px; border-radius: 8px; border: none; text-align: left; cursor: pointer; transition: background 0.2s; display: flex; flex-direction: column; }
  .failure-btn:hover { background: #5d728c; }
  .failure-btn strong { display: block; margin-bottom: 5px; font-size: 1.05rem; }
  .failure-btn .initial-context { font-size: 0.85rem; color: #b0b0b0; margin-top: 5px; font-style: italic; }

  /* √Årea de Diagn√≥stico Mejorada */
  .diagnosis-area { margin-top: 30px; background: #334455; padding: 25px; border-radius: 8px; }
  .diagnosis-area h2 { border-bottom-color: #5d728c; }
  
  /* Tarjetas de Informaci√≥n */
  .info-card { background: #3e5163; padding: 18px; border-radius: 6px; margin-bottom: 20px; border-left: 5px solid #f5af19; box-shadow: 0 3px 6px rgba(0,0,0,0.2); }
  .info-card h4 { color: #f5af19; margin-bottom: 10px; font-size: 1.2rem; }
  .info-card ul, .info-card ol { margin-left: 20px; padding-left: 10px; color: #d0d0d0; }
  .info-card li { margin-bottom: 8px; }
  .info-card p { color: #d0d0d0; margin-bottom: 10px; }
  
  /* Estilos Espec√≠ficos */
  .chain-step { background: #4a5d73; padding: 10px; border-radius: 4px; margin: 8px 0; border-left: 4px solid #f5af19; color: #e0e0e0; }
  .alert-safety { background: rgba(231, 76, 60, 0.8); border-left: 5px solid #c0392b; color: #fff; font-weight: bold;}
  .alert-engineer { background: rgba(39, 174, 96, 0.8); border-left: 5px solid #27ae60; color: #fff; }
  .codes-list code { background: #2c3e50; padding: 3px 6px; border-radius: 4px; font-family: Consolas, monospace; color: #ecf0f1; margin-right: 5px; }

  /* Botones de Acci√≥n */
  .action-buttons { display: flex; gap: 12px; margin-top: 20px; flex-wrap: wrap; }
  .search-btn { 
    background: #3498db; 
    color: #fff; 
    padding: 12px 18px; 
    border-radius: 5px; 
    border: none; 
    cursor: pointer; 
    transition: background 0.2s; 
    text-decoration: none; 
    display: inline-block; 
    font-size: 1rem; 
    line-height: 1.5;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
  }
  .search-btn:hover { background: #2980b9; box-shadow: 0 4px 8px rgba(0,0,0,0.3); }
  .reset-btn { background: #95a5a6; }
  .reset-btn:hover { background: #7f8c8d; }

</style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üöú HeavyDiag - Simulador Predictivo de Aver√≠as Mineras</h1>
      <p>Selecciona la m√°quina y la falla para obtener diagn√≥stico t√©cnico y gesti√≥n de costos.</p>
    </header>

    <div class="main-content">
      <section>
        <h2>Selecciona el tipo de maquinaria</h2>
        <div id="machinesGrid" class="machines-grid"></div>
      </section>

      <section id="failureSection" class="failure-section" style="display:none;">
        <h2>Selecciona una aver√≠a</h2>
        <div id="failuresList" class="failures-list"></div>
      </section>

      <section id="diagnosisArea" class="diagnosis-area" style="display:none;">
        <h2 id="diagnosisTitle">Diagn√≥stico Completo</h2>
        <div id="diagnosisResult">
            <!-- El contenido detallado se insertar√° aqu√≠ -->
        </div>

        <div class="action-buttons">
          <a id="btnOpenGoogle" class="search-btn" href="#" target="_blank">üåê Buscar m√°s en Google</a>
          <button id="btnReset" class="search-btn reset-btn">‚ôªÔ∏è Reiniciar Todo</button>
        </div>
        
      </section>
    </div>
  </div>

<script>
/* ----------------------------------------------------------------------------------------- */
/* HEAVYDIAG - DATOS Y L√ìGICA (v3 - Con Datos de Manuales) */
/* ----------------------------------------------------------------------------------------- */

const machines = {
    // Definici√≥n de m√°quinas (igual que antes)
    retroexcavadora: { name: "Retroexcavadora", icon: "üöú", description: "Excavaci√≥n y carga" },
    excavadora: { name: "Excavadora Hidr√°ulica", icon: "‚õèÔ∏è", description: "Excavaci√≥n profunda" },
    cargador: { name: "Cargador Frontal", icon: "üèóÔ∏è", description: "Carga de material" },
    dumper: { name: "Cami√≥n Minero (Dumper)", icon: "üöõ", description: "Transporte de material" },
    skidsteer: { name: "Cargador Compacto", icon: "üöß", description: "Equipo auxiliar y soporte" },
    camioneta: { name: "Camioneta Minera 4x4", icon: "üöô", description: "Transporte de personal" }
    // Podr√≠amos a√±adir motoniveladora aqu√≠ tambi√©n si hay datos
};

// Esta es tu base de datos de conocimiento AUMENTADA con info de los manuales.
// He agregado muchas m√°s fallas y detalles. ¬°Puedes seguir a√±adiendo!
const failures = {
    retroexcavadora: [
        // Komatsu WB93R-5 y CAT 416E / 420F (Combinado y ampliado de manuales)
        {
            id: 1, name: "Motor no arranca", initial: "El motor no enciende o gira muy lento.",
            alertaSeguridad: "‚ö†Ô∏è Asegurar freno de parqueo y verificar √°rea circundante antes de diagnosticar.",
            symptoms: ["No hay giro del motor", "Giro lento (cranking lento)", "Solo se escucha un 'clic'", "Luces del tablero se apagan al intentar arrancar"],
            causes: ["Bater√≠a descargada o terminales sulfatados", "Aire en sistema de combustible (l√≠neas vac√≠as)", "Fusible principal quemado", "Motor de arranque defectuoso", "Sensor de cig√ºe√±al (CKP) h√∫medo o defectuoso", "Filtro de combustible obstruido", "Baja compresi√≥n"],
            diagnosticSteps: [
                "1. Verificar voltaje de bater√≠a (>12.4V en reposo, >10V durante arranque).",
                "2. Limpiar terminales de bater√≠a.",
                "3. Purgar sistema de combustible (usar bomba manual si existe).",
                "4. Revisar fusibles principales (motor, arranque).",
                "5. Medir voltaje en solenoide del motor de arranque al dar contacto.",
                "6. Escanear c√≥digos de error (si aplica)."
            ],
            solution: ["Cargar o reemplazar bater√≠a", "Purgar combustible", "Reemplazar fusibles", "Reparar o reemplazar motor de arranque", "Secar o reemplazar sensor CKP"],
            costoEstimado: "US$ 100 (bater√≠a) - US$ 1,200 (motor de arranque)",
            searchTerms: "retroexcavadora motor no arranca purgar combustible",
            codes: ["E01 (Komatsu)", "MID 036 (CAT)"]
        },
        {
            id: 2, name: "P√©rdida de potencia del motor", initial: "La m√°quina se siente d√©bil, no sube pendientes o el motor humea.",
            alertaSeguridad: "Verificar temperaturas antes de abrir componentes.",
            symptoms: ["Humo negro excesivo", "Humo blanco/azul", "No alcanza RPM m√°ximas", "Consumo elevado de combustible", "Sobrecalentamiento bajo carga"],
            causes: ["Filtro de aire obstruido (muy com√∫n)", "Filtro de combustible saturado", "Inyectores sucios o desgastados", "Turbocompresor con fugas o atascado", "V√°lvula EGR carbonizada", "Bomba de inyecci√≥n defectuosa", "Baja compresi√≥n", "Intercooler obstruido"],
            diagnosticSteps: [
                "1. Reemplazar filtro de aire y combustible.",
                "2. Verificar presi√≥n de turbo (boost).",
                "3. Escanear c√≥digos de error (DTCs).",
                "4. Realizar prueba de retorno de inyectores.",
                "5. Verificar juego de v√°lvulas.",
                "6. Medir compresi√≥n del motor."
            ],
            solution: ["Cambio de filtros", "Limpieza o reemplazo de inyectores", "Reparaci√≥n o reemplazo de turbo", "Limpieza de EGR e intercooler", "Ajuste de v√°lvulas", "Reparaci√≥n mayor si hay baja compresi√≥n"],
            costoEstimado: "US$ 50 (filtros) - US$ 5,000+ (turbo/inyectores/motor)",
            searchTerms: "perdida potencia motor diesel retroexcavadora humo negro",
            codes: ["P0087", "P0299", "P0401"]
        },
        {
            id: 7, name: "Sobrecalentamiento del motor", initial: "Indicador de temperatura en zona roja, vapor visible.",
            alertaSeguridad: "‚ö†Ô∏è ¬°NO ABRIR TAPA DEL RADIADOR EN CALIENTE! Riesgo de quemaduras graves.",
            symptoms: ["Temperatura >105¬∞C", "P√©rdida de refrigerante", "Ventilador no acopla o gira lento", "Mangueras hinchadas"],
            causes: ["Nivel bajo de refrigerante", "Radiador obstruido (externa o internamente)", "Termostato atascado cerrado (com√∫n)", "Bomba de agua defectuosa", "Correa del ventilador floja o rota", "Tapa del radiador no mantiene presi√≥n", "Fuga en junta de culata (casos graves)"],
            diagnosticSteps: [
                "1. Dejar enfriar. Verificar nivel de refrigerante.",
                "2. Inspeccionar radiador por suciedad externa.",
                "3. Revisar tensi√≥n y estado de la correa del ventilador.",
                "4. Verificar si el ventilador acopla (viscoso o hidr√°ulico).",
                "5. Probar termostato en agua caliente (debe abrir ~82¬∞C).",
                "6. Realizar prueba de presi√≥n al sistema de enfriamiento para detectar fugas.",
                "7. Verificar si hay burbujas en el refrigerante (indica fuga de culata)."
             ],
            solution: ["Rellenar refrigerante (tipo correcto)", "Limpieza de radiador", "Reemplazo de termostato", "Reemplazo de bomba de agua", "Ajuste o cambio de correa", "Cambio de tapa de radiador", "Reparaci√≥n de junta de culata"],
            costoEstimado: "US$ 30 (tapa) - US$ 3,000+ (junta culata)",
            searchTerms: "motor retroexcavadora sobrecalienta termostato radiador",
            codes: ["E230-2 (CAT)", "E03 (Komatsu)"]
        },
         {
            id: 8, name: "Movimientos hidr√°ulicos lentos", initial: "El brazo, balanc√≠n o cuchar√≥n se mueven muy despacio.",
            alertaSeguridad: "Verificar que la m√°quina est√© estable antes de pruebas.",
            symptoms: ["Todos los movimientos son lentos", "Solo un movimiento es lento", "Ruido en la bomba hidr√°ulica (chillido o golpeteo)", "Aceite hidr√°ulico sobrecalentado (>85¬∞C)", "Espuma en el aceite hidr√°ulico"],
            causes: ["Nivel bajo de aceite hidr√°ulico (m√°s com√∫n)", "Filtro hidr√°ulico (succi√≥n o retorno) obstruido", "Aire en el sistema (cavitaci√≥n)", "Bomba hidr√°ulica desgastada", "V√°lvula de alivio principal mal ajustada o atascada", "Aceite hidr√°ulico incorrecto o degradado", "Fuga interna en un cilindro o v√°lvula"],
            diagnosticSteps: [
                "1. Verificar nivel de aceite hidr√°ulico (con m√°quina nivelada y fr√≠a).",
                "2. Revisar indicador de restricci√≥n del filtro (si existe) o reemplazar filtros.",
                "3. Escuchar la bomba: ruido indica cavitaci√≥n (aire o filtro tapado).",
                "4. Medir presi√≥n hidr√°ulica principal con man√≥metro (ej: 3000-3600 PSI).",
                "5. Medir temperatura del aceite hidr√°ulico.",
                "6. Purgar aire del sistema si se sospecha cavitaci√≥n.",
                "7. Realizar prueba de ca√≠da (drift) en cilindros para detectar fugas internas."
             ],
            solution: ["Rellenar aceite hidr√°ulico (ISO VG 46 o especificado)", "Cambiar filtros hidr√°ulicos", "Purgar aire", "Reparar o reemplazar bomba hidr√°ulica", "Ajustar o limpiar v√°lvula de alivio", "Cambiar aceite hidr√°ulico completo", "Reparar cilindro con fuga interna"],
            costoEstimado: "US$ 100 (filtros) - US$ 10,000+ (bomba nueva)",
            searchTerms: "hidraulico lento retroexcavadora bomba ruido cavitacion",
            codes: ["094-03 (CAT)", "E04 (Komatsu)"]
        },
        // ... (M√°s fallas de retroexcavadoras de los manuales) ...
    ],
    excavadora: [
        // CAT 320D/E/F y Komatsu PC200 (Combinado y ampliado de manuales)
        {
            id: 9, name: "Bomba Hidr√°ulica Principal Ruidosa", initial: "Ruido de gemido, chillido o golpeteo constante desde la bomba.",
            alertaSeguridad: "‚ö†Ô∏è Peligro de alta presi√≥n. No desconectar mangueras sin despresurizar.",
            symptoms: ["Ruido anormal (gemido, chillido, martilleo)", "Movimientos lentos o err√°ticos", "Temperatura aceite hidr√°ulico >80¬∞C", "Vibraci√≥n excesiva", "Espuma en el aceite"],
            causes: ["Cavitaci√≥n (aire en el sistema por nivel bajo o filtro succi√≥n tapado)", "Desgaste interno severo (pistones, plato oscilante)", "Aceite contaminado con agua o part√≠culas", "Viscosidad del aceite incorrecta", "Filtro piloto obstruido", "Acoplamiento bomba-motor desgastado"],
            diagnosticSteps: [
                "1. ¬°Verificar nivel de aceite hidr√°ulico INMEDIATAMENTE!",
                "2. Inspeccionar filtro de succi√≥n por colapso u obstrucci√≥n.",
                "3. Medir temperatura del aceite.",
                "4. Escuchar atentamente el tipo de ruido (gemido=cavitaci√≥n, golpeteo=da√±o mec√°nico).",
                "5. Medir presi√≥n principal y piloto.",
                "6. Tomar muestra de aceite para an√°lisis (conteo de part√≠culas)."
             ],
            solution: ["Corregir nivel de aceite", "Reemplazar filtro de succi√≥n", "Purgar aire", "Cambio completo de aceite y filtros si est√° contaminado", "Reparaci√≥n mayor (Overhaul) de la bomba si hay da√±o interno", "Reemplazo de bomba"],
            costoEstimado: "US$ 150 (filtro) - US$ 30,000+ (bomba nueva)",
            searchTerms: "bomba hidraulica excavadora ruido cavitacion sobrecalentamiento",
            codes: ["094-03 (CAT)", "E04 (Komatsu)"]
        },
        {
            id: 10, name: "Motor de Giro (Swing) sin Fuerza o Lento", initial: "La torreta gira despacio, no puede girar con carga o se detiene.",
            alertaSeguridad: "Asegurar √°rea de trabajo antes de probar giro.",
            symptoms: ["Giro lento (< 7 RPM con carga)", "No gira en pendientes", "Ruido met√°lico en motor de giro o corona", "Freno de giro no libera", "Sobrecalentamiento del motor de giro"],
            causes: ["Desgaste interno del motor hidr√°ulico de giro", "Freno de giro trabado o mal ajustado", "Presi√≥n hidr√°ulica insuficiente en circuito de giro", "V√°lvula de alivio cruzado (cross-over relief) defectuosa", "Rodamiento de la corona de giro da√±ado", "Bajo nivel de aceite en caja reductora de giro"],
            diagnosticSteps: [
                "1. Medir presi√≥n del circuito de giro bajo carga.",
                "2. Verificar si el freno de giro libera (el√©ctrica o hidr√°ulicamente).",
                "3. Medir velocidad de giro (RPM).",
                "4. Escuchar ruidos en la corona y motor de giro.",
                "5. Verificar nivel y estado del aceite de la caja reductora de giro.",
                "6. Inspeccionar el pi√±√≥n de giro por desgaste."
             ],
            solution: ["Ajuste o reparaci√≥n del freno de giro", "Reparaci√≥n (Overhaul) del motor de giro", "Reemplazo de motor de giro", "Ajuste o reemplazo de v√°lvulas de alivio", "Reemplazo del rodamiento de la corona (trabajo mayor)", "Cambio de aceite de caja reductora"],
            costoEstimado: "US$ 500 (ajuste freno) - US$ 20,000+ (corona/motor)",
            searchTerms: "motor giro excavadora lento sin fuerza freno trabado",
            codes: ["E05 (Komatsu)", "MID 027 (CAT)"]
        },
        // ... (M√°s fallas de excavadoras) ...
    ],
    cargador: [
        // CAT 950/966 y Komatsu WA380 (Combinado y ampliado de manuales)
        {
            id: 11, name: "Transmisi√≥n Powershift Desliza o Patea", initial: "RPM suben pero la m√°quina no avanza, o los cambios son muy bruscos.",
            alertaSeguridad: "Pruebas de transmisi√≥n requieren espacio seguro y calzos.",
            symptoms: ["Deslizamiento (RPM altas, poca velocidad)", "Golpe fuerte al cambiar de marcha", "Olor a aceite quemado", "Temperatura de transmisi√≥n alta (>120¬∞C)", "Modo de protecci√≥n activado (Limp Mode)"],
            causes: ["Discos de embrague (clutch packs) desgastados o quemados", "Nivel bajo de aceite de transmisi√≥n", "Aceite incorrecto o degradado (¬°usar solo TO-4!)", "Filtro de transmisi√≥n obstruido", "Solenoides de cambio defectuosos", "V√°lvula de modulaci√≥n descalibrada o trabada", "Convertidor de par da√±ado", "Enfriador de aceite obstruido"],
            diagnosticSteps: [
                "1. Verificar nivel y condici√≥n del aceite (motor caliente, neutro). ¬°Olerlo!",
                "2. Escanear c√≥digos de error con herramienta de diagn√≥stico (ET/KOMTRAX).",
                "3. Realizar prueba de calado (stall test) para verificar deslizamiento.",
                "4. Medir presiones de los paquetes de embrague con man√≥metros.",
                "5. Verificar temperatura de operaci√≥n.",
                "6. Inspeccionar enfriador por obstrucci√≥n."
            ],
            solution: ["Cambio de aceite y filtro (usar TO-4)", "Reemplazo de solenoides", "Calibraci√≥n electr√≥nica de la modulaci√≥n", "Reparaci√≥n mayor (Overhaul) de la transmisi√≥n (cambio de discos)", "Reemplazo del convertidor de par", "Limpieza del enfriador"],
            costoEstimado: "US$ 500 (aceite/filtro) - US$ 50,000+ (Overhaul completo)",
            searchTerms: "transmision cargador frontal desliza patea cambios bruscos",
            codes: ["077-03 (CAT)", "E04 (Komatsu)"]
        },
        // ... (M√°s fallas de cargadores frontales) ...
    ],
    dumper: [
         // CAT 777/785 y Komatsu HD785 (Combinado y ampliado de manuales)
         {
            id: 12, name: "Frenos Sobrecalentados / Freno D√©bil", initial: "Olor a quemado, discos al rojo, cami√≥n no frena bien en pendiente.",
            alertaSeguridad: "‚ö†Ô∏è ¬°PELIGRO EXTREMO! Falla de frenos puede ser fatal. NO operar si se sospecha.",
            symptoms: ["Discos de freno visibles al rojo vivo (>600¬∞C)", "Olor intenso a quemado", "Pedal esponjoso o va al fondo", "Distancia de frenado muy larga", "Retardador no funciona o es insuficiente", "Vibraci√≥n severa al frenar"],
            causes: ["Uso excesivo de frenos de servicio (¬°NO usar retardador!)", "Retardador hidr√°ulico inoperativo o mal usado", "Fugas en el sistema de aire (si son neum√°ticos) o hidr√°ulico", "Nivel bajo de aceite de enfriamiento de frenos (si aplica)", "Discos y pastillas desgastados por debajo del l√≠mite", "Pistones de caliper trabados", "Aire en el sistema hidr√°ulico"],
            diagnosticSteps: [
                "1. ¬°DETENER OPERACI√ìN INMEDIATAMENTE!",
                "2. Dejar enfriar los frenos (puede tomar horas).",
                "3. Inspeccionar visualmente discos (color, grietas) y pastillas (espesor).",
                "4. Verificar funcionamiento del RETARDADOR HIDR√ÅULICO.",
                "5. Revisar niveles de fluidos (hidr√°ulico, enfriamiento de frenos).",
                "6. Purgar sistema si se sospecha aire.",
                "7. Medir presiones del sistema de frenos y retardador.",
                "8. Escanear c√≥digos de error."
            ],
            solution: ["Reparaci√≥n URGENTE del retardador", "Reemplazo de discos y pastillas", "Rebuild de calipers", "Purgado del sistema", "Cambio de fluido de enfriamiento de frenos", "Capacitaci√≥n al operador sobre uso correcto del retardador"],
            costoEstimado: "US$ 5,000 (pastillas) - US$ 100,000+ (sistema completo)",
            searchTerms: "frenos camion minero sobrecalentados retardador no funciona",
            codes: ["E07 (Komatsu)", "MID 068 (CAT)"]
        },
        // ... (M√°s fallas de camiones mineros) ...
    ],
    camioneta: [
        // Toyota Hilux / Mitsubishi L200 (Combinado y ampliado de manuales)
        {
            id: 13, name: "Sistema 4x4 No Acopla o Parpadea", initial: "La luz 4WD parpadea en el tablero y la tracci√≥n no entra.",
            alertaSeguridad: "No forzar el sistema si no acopla.",
            symptoms: ["Luz 4WD parpadea", "No se siente el acople (sin 'clunk')", "A veces entra, a veces no", "Ruido al intentar acoplar"],
            causes: ["Actuador el√©ctrico del diferencial delantero (ADD) defectuoso (muy com√∫n)", "Switch de vac√≠o o solenoides de vac√≠o (VSV) fallando", "Fuga en mangueras de vac√≠o", "Sensor de posici√≥n de la transfer defectuoso", "M√≥dulo de control 4WD (ECU) fallando", "Bajo nivel de aceite en diferencial delantero o transfer"],
            diagnosticSteps: [
                "1. Escanear c√≥digos de error del sistema 4WD.",
                "2. Verificar fusibles relacionados con 4WD.",
                "3. Probar actuador ADD: aplicar 12V directamente para ver si se mueve.",
                "4. Revisar mangueras de vac√≠o por grietas o desconexiones.",
                "5. Probar solenoides de vac√≠o (VSV) con mult√≠metro o aplicando 12V.",
                "6. Verificar se√±al de sensores de posici√≥n."
             ],
            solution: ["Reemplazo del actuador ADD", "Reemplazo de solenoides VSV", "Reparaci√≥n de mangueras de vac√≠o", "Reemplazo de sensor de transfer", "Cambio de aceite de diferenciales y transfer"],
            costoEstimado: "US$ 50 (mangueras) - US$ 800 (actuador/ECU)",
            searchTerms: "luz 4x4 parpadea hilux l200 actuador ADD",
            codes: ["C1241", "P17xx"]
        },
        // ... (M√°s fallas de camionetas) ...
    ],
    skidsteer: [
         // Bobcat / CAT Compactos (General)
        {
            id: 14, name: "Sistema de Bloqueo de Brazo (Interlock) No Desactiva", initial: "M√°quina arranca pero los brazos/balde no se mueven.",
            alertaSeguridad: "‚ö†Ô∏è NO intentar puentear sistemas de seguridad. Riesgo de accidente grave.",
            symptoms: ["Luz de advertencia de 'Seat Bar' o cintur√≥n encendida", "Brazos y balde bloqueados", "A veces funciona intermitentemente"],
            causes: ["Sensor de la barra de seguridad (Seat Bar) defectuoso o desajustado", "Sensor del cintur√≥n de seguridad fallando", "Solenoide de bloqueo hidr√°ulico (BICS) atascado o quemado", "Problema de cableado hacia los sensores o solenoide", "ECU con falla"],
            diagnosticSteps: [
                "1. Asegurarse de que la barra de seguridad est√© completamente bajada.",
                "2. Verificar que el cintur√≥n de seguridad est√© abrochado.",
                "3. Revisar fusibles del sistema BICS/Interlock.",
                "4. Probar sensores de barra y cintur√≥n (continuidad con mult√≠metro).",
                "5. Medir voltaje en el solenoide de bloqueo hidr√°ulico (debe recibir 12V).",
                "6. Escanear c√≥digos de error si la m√°quina lo permite."
             ],
            solution: ["Ajuste o reemplazo del sensor de la barra de seguridad", "Reemplazo del sensor del cintur√≥n", "Reemplazo del solenoide BICS", "Reparaci√≥n del cableado"],
            costoEstimado: "US$ 100 (sensor) - US$ 1,000 (solenoide/ECU)",
            searchTerms: "skid steer brazos no mueven interlock BICS",
            codes: ["Revisar manual espec√≠fico de marca"]
        },
        // ... (M√°s fallas de skid steer) ...
    ]
};

// --- UI / L√ìGICA ---
let selectedMachineKey = null;
let selectedFailure = null;
const grid = document.getElementById('machinesGrid');
const failureSection = document.getElementById('failureSection');
const diagnosisArea = document.getElementById('diagnosisArea');
const diagnosisResult = document.getElementById('diagnosisResult');
const diagnosisTitle = document.getElementById('diagnosisTitle'); // Para actualizar el t√≠tulo

function initMachines(){
    grid.innerHTML = '';
    Object.keys(machines).forEach(key=>{
        const m = machines[key];
        const card = document.createElement('div');
        card.className = 'machine-card';
        // A√±adida clase description para el texto peque√±o
        card.innerHTML = `<div style="font-size:32px">${m.icon}</div><strong>${m.name}</strong><div class="description">${m.description}</div>`;
        card.onclick = () => {
            document.querySelectorAll('.machine-card').forEach(c=>c.classList.remove('selected'));
            card.classList.add('selected');
            selectMachine(key);
        };
        grid.appendChild(card);
    });
}

function selectMachine(key) {
    selectedMachineKey = key;
    const list = document.getElementById('failuresList');
    list.innerHTML = '';
    failureSection.style.display = 'block';
    diagnosisArea.style.display = 'none'; // Ocultar diagn√≥stico al cambiar de m√°quina

    const machineFailures = failures[key] || [];

    if (machineFailures.length === 0) {
        list.innerHTML = `<p style="color: #f5af19; padding: 10px; text-align: center;">A√∫n no hay fallas definidas para ${machines[key].name}. ¬°A√±ade m√°s!</p>`;
    } else {
        machineFailures.forEach(f => {
            const btn = document.createElement('button');
            btn.className = 'failure-btn';
            // A√±adida clase initial-context para el texto peque√±o
            btn.innerHTML = `<strong>${f.name}</strong><div class="initial-context">${f.initial}</div>`;
            btn.onclick = () => showDiagnosis(f);
            list.appendChild(btn);
        });
    }
     // Desplazar a la secci√≥n de fallas
     window.scrollTo({top: failureSection.offsetTop - 20, behavior:'smooth'});
}

function showDiagnosis(f) {
    selectedFailure = f;
    diagnosisArea.style.display = 'block';
    diagnosisTitle.innerText = `Diagn√≥stico: ${f.name}`; // T√≠tulo din√°mico
    
    // --- CONSTRUCCI√ìN DEL HTML DE DIAGN√ìSTICO MEJORADO ---
    // Usamos plantillas literales para construir el HTML de forma m√°s limpia
    diagnosisResult.innerHTML = `
        ${f.alertaSeguridad ? `<div class="alert-safety"><h4>‚ö†Ô∏è ALERTA DE SEGURIDAD (HSE)</h4><p>${f.alertaSeguridad}</p></div>` : ''}

        <div class="info-card">
            <h4><i class="fas fa-exclamation-triangle"></i> S√≠ntomas Comunes</h4>
            <ul>${f.symptoms.map(s=>`<li>${s}</li>`).join('')}</ul>
            <p style="margin-top:10px;"><strong>Contexto Inicial:</strong> ${f.initial}</p>
        </div>
        
        <div class="info-card">
            <h4><i class="fas fa-project-diagram"></i> Causas Probables</h4>
             <ul>${f.causes.map(c=>`<li>${c}</li>`).join('')}</ul>
        </div>
        
        <div class="info-card">
            <h4><i class="fas fa-stethoscope"></i> Pasos de Diagn√≥stico</h4>
            <ol>${f.diagnosticSteps.map(s=>`<li>${s}</li>`).join('')}</ol>
        </div>

        <div class="info-card">
            <h4><i class="fas fa-wrench"></i> Soluciones Recomendadas</h4>
             <ul>${f.solution.map(s=>`<li>${s}</li>`).join('')}</ul>
        </div>

        <div class="info-card">
            <h4><i class="fas fa-dollar-sign"></i> Gesti√≥n y Log√≠stica</h4>
            <p><strong>Costo Estimado de Reparaci√≥n:</strong> ${f.costoEstimado || 'Variable'}</p>
            ${f.tiempoDowntime ? `<p><strong>Tiempo de Inactividad (Downtime):</strong> ${f.tiempoDowntime}</p>` : ''}
        </div>
        
        ${f.codes ? 
          `<div class="info-card codes-list">
              <h4><i class="fas fa-laptop-code"></i> C√≥digos de Error Comunes</h4>
              <p>${f.codes.map(c=>`<code>${c}</code>`).join(' ')}</p>
          </div>` : ''
        }

        ${f.datoIngeniero ? 
          `<div class="alert-engineer">
              <h4>üí° Dato T√©cnico del Ingeniero</h4>
              <p>${f.datoIngeniero}</p>
          </div>` : ''
        }
    `;
    
    // Asignar din√°micamente el enlace de b√∫squeda de Google
    const googleBtn = document.getElementById('btnOpenGoogle');
    const q = encodeURIComponent(f.searchTerms || f.name);
    googleBtn.href = `https://www.google.com/search?q=${q}+${machines[selectedMachineKey].name}`; // A√±ade nombre de m√°quina a la b√∫squeda

    // Desplazar al √°rea de diagn√≥stico
    window.scrollTo({top: diagnosisArea.offsetTop - 20, behavior:'smooth'});
}

// --- BOTONES DE ACCI√ìN ---
document.addEventListener('DOMContentLoaded', () => {
    // Inicia las m√°quinas cuando la p√°gina carga
    initMachines();
    
    // L√≥gica del bot√≥n de Reset
    document.getElementById('btnReset').addEventListener('click', () => {
        // location.reload(); // Recarga completa
        // Ocultar secciones y deseleccionar
        failureSection.style.display = 'none';
        diagnosisArea.style.display = 'none';
        document.querySelectorAll('.machine-card').forEach(c=>c.classList.remove('selected'));
        selectedMachineKey = null;
        selectedFailure = null;
        window.scrollTo({top: 0, behavior:'smooth'}); // Volver al inicio
    });
});

// A√±adir √≠conos (requiere Font Awesome) - Opcional
// A√±adir al <head>: <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</script>
</body>
</html>

